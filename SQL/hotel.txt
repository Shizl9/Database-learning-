CREATE DATABASE hotel;
USE hotel;

CREATE TABLE Branch (
    branch_id INT PRIMARY KEY IDENTITY(1,1),
    name NVARCHAR(50) NOT NULL,
    location NVARCHAR(100) NOT NULL
);

CREATE TABLE Room (
    room_no INT,
    branch_id INT NOT NULL,
    room_type NVARCHAR(30) NOT NULL,
    nightly_rate DECIMAL(10,2) NOT NULL,
    PRIMARY KEY (room_no, branch_id),
    FOREIGN KEY (branch_id) REFERENCES Branch(branch_id)
);

CREATE TABLE Customer (
    customer_id INT PRIMARY KEY IDENTITY(1,1),
    name NVARCHAR(50) NOT NULL,
    phone NVARCHAR(20) NULL,
    email NVARCHAR(50) NULL
);

CREATE TABLE Booking (
    booking_id INT PRIMARY KEY IDENTITY(1,1),
    customer_id INT NOT NULL,
    check_in_date DATE NOT NULL,
    check_out_date DATE NOT NULL,
    status NVARCHAR(20) DEFAULT 'Pending',
    total_cost DECIMAL(10,2) DEFAULT 0,
    FOREIGN KEY (customer_id) REFERENCES Customer(customer_id)
);

CREATE TABLE BookingRoom (
    booking_id INT NOT NULL,
    room_no INT NOT NULL,
    branch_id INT NOT NULL,
    PRIMARY KEY (booking_id, room_no, branch_id),
    FOREIGN KEY (booking_id) REFERENCES Booking(booking_id),
    FOREIGN KEY (room_no, branch_id) REFERENCES Room(room_no, branch_id)
);

CREATE TABLE Staff (
    staff_id INT PRIMARY KEY IDENTITY(1,1),
    branch_id INT NOT NULL,
    name NVARCHAR(50) NOT NULL,
    job_title NVARCHAR(30) NOT NULL,
    salary DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (branch_id) REFERENCES Branch(branch_id)
);

CREATE TABLE StaffAction (
    staff_id INT NOT NULL,
    booking_id INT NOT NULL,
    action_type NVARCHAR(20) NOT NULL,
    action_date DATETIME NOT NULL,
    PRIMARY KEY (staff_id, booking_id, action_type, action_date),
    FOREIGN KEY (staff_id) REFERENCES Staff(staff_id),
    FOREIGN KEY (booking_id) REFERENCES Booking(booking_id)
);
-- Branches
INSERT INTO Branch (name, location)
VALUES
('Muscat Hotel', 'Muscat, Oman'),
('Salalah Resort', 'Salalah, Oman');
select *from Branch 
-- Rooms
INSERT INTO Room (room_no, branch_id, room_type, nightly_rate)
VALUES
(101, 1, 'Single', 50.00),
(102, 1, 'Double', 80.00),
(103, 1, 'Suite', 150.00),
(101, 2, 'Single', 55.00),
(102, 2, 'Double', 85.00),
(103, 2, 'Suite', 160.00);
select *from Room 
-- Customers
INSERT INTO Customer (name, phone, email)
VALUES
('Fatma Al Harthy', '968-99123456', 'fatma@example.com'),
('Sultan Al Busaidi', '968-99111222', 'sultan@example.com'),
('Aisha Al Lawati', '968-99555555', 'aisha@example.com');
select *from Customer 
-- Bookings
INSERT INTO Booking (customer_id, check_in_date, check_out_date, status, total_cost)
VALUES
(1, '2025-12-20', '2025-12-22', 'Pending', 130.00),
(2, '2025-12-21', '2025-12-23', 'Pending', 55.00),
(3, '2025-12-22', '2025-12-24', 'Pending', 150.00);
select *from Booking 
-- BookingRoom
INSERT INTO BookingRoom (booking_id, room_no, branch_id)
VALUES
(1, 101, 1),
(1, 102, 1),
(2, 101, 2),
(3, 103, 1);
select *from BookingRoom 
-- Staff
INSERT INTO Staff (branch_id, name, job_title, salary)
VALUES
(1, 'Ahmed Al Maskari', 'Receptionist', 400.00),
(1, 'Noor Al Habsi', 'Manager', 800.00),
(2, 'Hassan Al Shukaili', 'Receptionist', 420.00),
(2, 'Lina Al Lawati', 'Manager', 820.00);
select *from Staff
-- StaffAction
INSERT INTO StaffAction (staff_id, booking_id, action_type, action_date)
VALUES
(1, 1, 'check-in', '2025-12-20 14:00'),
(1, 1, 'check-out', '2025-12-22 12:00'),
(3, 2, 'check-in', '2025-12-21 15:00');
select *from StaffAction
--DQL
-- 1. Display all guest records
SELECT * FROM Customer;

-- 2. Display each guestâ€™s name, phone, and email
SELECT name, phone, email AS proof_id FROM Customer;

-- 3. Display all bookings with status and total cost
SELECT booking_id, check_in_date AS booking_date, status, total_cost
FROM Booking;

-- 4. Display each room number and its nightly rate
SELECT room_no, nightly_rate AS NightlyRate FROM Room;

-- 5. List rooms priced above 100 per night
SELECT room_no, nightly_rate FROM Room WHERE nightly_rate > 100;

-- 6. Display staff members working as 'Receptionist'
SELECT name, job_title FROM Staff WHERE job_title = 'Receptionist';

-- 7. Display bookings made in 2025
SELECT * FROM Booking WHERE YEAR(check_in_date) = 2025;

-- 8. Display bookings ordered by total cost descending
SELECT * FROM Booking ORDER BY total_cost DESC;

-- 9. Display the maximum, minimum, and average room price
SELECT MAX(nightly_rate) AS MaxPrice,
       MIN(nightly_rate) AS MinPrice,
       AVG(nightly_rate) AS AvgPrice
FROM Room;

-- 10. Total number of rooms
SELECT COUNT(*) AS TotalRooms FROM Room;

-- 11. Guests whose names start with 'M'
SELECT * FROM Customer WHERE name LIKE 'M%';

-- 12. Rooms priced between 80 and 160
SELECT * FROM Room WHERE nightly_rate BETWEEN 80 AND 160;
--DML
-- 13. Insert yourself as a guest
INSERT INTO Customer (name, phone, email)
VALUES ('Sheika', '95165165', 'sheika02x2@gmail.com');

-- 14. Create a booking for room 102 in branch 1
INSERT INTO Booking (customer_id, check_in_date, check_out_date, status, total_cost)
VALUES (4, '2025-12-25', '2025-12-27', 'Pending', 160.00);

INSERT INTO BookingRoom (booking_id, room_no, branch_id)
VALUES (4, 102, 1);

-- 15. Insert another guest with NULL phone and email
INSERT INTO Customer (name, phone, email)
VALUES ('Test Guest', NULL, NULL);

-- 16. Update your booking status to 'Confirmed'
UPDATE Booking SET status = 'Confirmed' WHERE booking_id = 4;

-- 17. Increase Suite room prices by 10%
UPDATE Room SET nightly_rate = nightly_rate * 1.10 WHERE room_type = 'Suite';

-- 18. Update booking status to 'Completed' where checkout date is before today
UPDATE Booking SET status = 'Completed' WHERE check_out_date < GETDATE();

-- 19. Delete bookings with status 'Cancelled'
DELETE FROM Booking WHERE status = 'Cancelled';
